---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import { DEFAULT_IMAGES } from '../../utils/images';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
  <article class="prose prose-lg lg:prose-xl mx-auto px-4 py-8">
    <div class="not-prose mb-8">
      {post.data.image ? (
        <Image
          src={post.data.image.src}
          alt={post.data.image.alt}
          width={post.data.image.width}
          height={post.data.image.height}
          class="w-full aspect-video object-cover rounded-xl shadow-lg"
        />
      ) : (
        <Image
          src={DEFAULT_IMAGES.post.src}
          alt={`${post.data.title} featured image`}
          width={DEFAULT_IMAGES.post.width}
          height={DEFAULT_IMAGES.post.height}
          class="w-full aspect-video object-cover rounded-xl shadow-lg"
        />
      )}
    </div>

    <header class="text-center mb-12">
      <div class="flex items-center justify-center gap-4 mb-4">
        <span class="badge badge-primary">{post.data.category}</span>
        {post.data.featured && <span class="badge">Featured</span>}
      </div>
      <h1 class="mb-4">{post.data.title}</h1>
      <p class="text-xl text-base-content/80 mb-6">{post.data.description}</p>
      <div class="flex items-center justify-center gap-4">
        <div class="flex items-center gap-2">
          <Image
            src={post.data.authorImage || DEFAULT_IMAGES.profile.src}
            alt={post.data.author}
            width={DEFAULT_IMAGES.profile.width}
            height={DEFAULT_IMAGES.profile.height}
            class="w-10 h-10 rounded-full object-cover"
          />
          <span class="font-medium">{post.data.author}</span>
        </div>
        <span class="text-base-content/60">{post.data.date}</span>
      </div>
    </header>

    <Content />
  </article>
</Layout>
