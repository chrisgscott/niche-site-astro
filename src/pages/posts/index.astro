---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import { DEFAULT_IMAGES } from '../../utils/images';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Get site configuration for SEO
const [siteConfig] = await getCollection('config', ({ id }) => id === 'site.mdx');
---

<Layout 
  title="Blog Posts | Digital Marketing Insights"
  description="Expert insights, guides, and strategies for digital marketing success">
  <div class="container mx-auto px-4 py-12">
    <header class="text-center mb-16">
      <h1 class="text-4xl md:text-5xl font-bold mb-6">Latest Blog Posts</h1>
      <p class="text-xl text-base-content/80 max-w-2xl mx-auto">
        Expert insights, guides, and strategies to help you succeed in digital marketing
      </p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedPosts.map((post) => (
        <article class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-200">
          <a href={`/posts/${post.slug}`} class="hover:opacity-90 transition-opacity">
            {post.data.image ? (
              <Image
                src={post.data.image.src}
                alt={post.data.image.alt}
                width={post.data.image.width}
                height={post.data.image.height}
                class="w-full aspect-video object-cover rounded-t-xl"
              />
            ) : (
              <Image
                src={DEFAULT_IMAGES.post.src}
                alt={`${post.data.title} featured image`}
                width={DEFAULT_IMAGES.post.width}
                height={DEFAULT_IMAGES.post.height}
                class="w-full aspect-video object-cover rounded-t-xl"
              />
            )}
          </a>

          <div class="card-body">
            <div class="flex items-center gap-2 mb-2">
              <span class="badge badge-primary">{post.data.category}</span>
              {post.data.featured && <span class="badge">Featured</span>}
            </div>

            <h2 class="card-title hover:text-primary">
              <a href={`/posts/${post.slug}`}>{post.data.title}</a>
            </h2>

            <p class="text-base-content/70 line-clamp-2 mb-4">
              {post.data.description}
            </p>

            <div class="flex items-center gap-4 mt-auto">
              <div class="flex items-center gap-2">
                <Image
                  src={post.data.authorImage || DEFAULT_IMAGES.profile.src}
                  alt={post.data.author}
                  width={DEFAULT_IMAGES.profile.width}
                  height={DEFAULT_IMAGES.profile.height}
                  class="w-8 h-8 rounded-full object-cover"
                />
                <span class="text-sm font-medium">{post.data.author}</span>
              </div>
              <span class="text-sm text-base-content/60">{post.data.date}</span>
            </div>
          </div>
        </article>
      ))}
    </div>
  </div>
</Layout>
