---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Image } from "astro:assets";

export const getStaticPaths = async () => {
  const articles = await getCollection("articles");
  const path = articles.map((article) => {
    return {
      params: {
        slug: article.slug,
      },
      props: {
        article,
      },
    };
  });
  return path;
};

type Props = {
  article: CollectionEntry<"articles">;
};

const { article } = Astro.props;
const { Content } = await article.render();

// Get the parent topic if it exists
const topics = article.data.topic ? 
  await getCollection("topics", (topic) => 
    topic.data.links.articles.includes(article.slug)
  ) : [];
const parentTopic = topics[0];
---

<Layout title={article.data.title} description={article.data.description}>
  <article class="w-full flex flex-col items-center">
    <header class="max-w-2xl mt-5">
      <div class="flex flex-wrap gap-2 mb-4">
        <div class="badge badge-outline">Article</div>
        {article.data.schema && (
          <div class="badge badge-outline">{article.data.schema}</div>
        )}
      </div>

      <section class="flex mb-6">
        <img
          src="/images/ai-author.png"
          alt="AI Content Team"
          class="w-10 h-10 rounded-full object-cover"
        />
        <div class="flex flex-col ml-3">
          <span class="text-sm font-medium">AI Content Team</span>
          <time class="text-sm text-gray-500">{article.data.date}</time>
        </div>
      </section>

      {article.data.image && (
        <img
          src={article.data.image}
          alt={article.data.title}
          class="w-full h-[300px] object-cover rounded-lg mb-8"
        />
      )}
    </header>

    <div class="prose prose-lg max-w-2xl">
      <Content />
    </div>

    {/* FAQ Section */}
    {article.data.faq && article.data.faq.length > 0 && (
      <div class="max-w-2xl w-full mt-12">
        <h2 class="text-3xl font-bold mb-6">Frequently Asked Questions</h2>
        <div class="space-y-4">
          {article.data.faq.map((item) => (
            <div class="collapse collapse-plus bg-base-200">
              <input type="radio" name="faq-accordion" /> 
              <div class="collapse-title text-xl font-medium">
                {item.question}
              </div>
              <div class="collapse-content">
                <p>{item.answer}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    )}

    {/* Variations */}
    {article.data.variations && Object.keys(article.data.variations).length > 0 && (
      <div class="max-w-2xl w-full mt-12">
        <h2 class="text-3xl font-bold mb-6">Available Options</h2>
        {Object.entries(article.data.variations).map(([category, options]) => (
          <div class="mb-6">
            <h3 class="text-xl font-semibold mb-3 capitalize">{category}</h3>
            <div class="flex flex-wrap gap-2">
              {options.map((option) => (
                <div class="badge badge-outline">{option}</div>
              ))}
            </div>
          </div>
        ))}
      </div>
    )}
  </article>
</Layout>
